# Enhancement #001: ドラッグ中にウィジェットのアウトラインレイアウトを表示

**ステータス**: 🔴 未着手
**優先度**: Medium
**カテゴリ**: UX
**担当**: 未割当
**見積もり時間**: 2-4時間
**実績時間**: -
**作成日**: 2025-10-22
**完了日**: -

## 📋 改善概要

ウィジェットをドラッグしている間に、現在は「移動中...」というテキストのみが表示されているが、ウィジェットのアウトライン（オブジェクトレイアウト）を表示することで、ドロップ先をより詳細に決めやすくする。

## 🎯 目的・背景

現状、ウィジェットをドラッグ中は「移動中...」というテキストのみが表示されるため、ドロップ先の正確な位置やサイズ感を把握しづらい。ウィジェットのアウトラインを表示することで、ユーザーがより直感的に配置位置を決定できるようになり、UXが向上する。

## 📊 現状の問題点

- ドラッグ中に「移動中...」というテキストのみが表示される
- ウィジェットの実際のサイズや形状が視覚的に確認できない
- ドロップ先の位置を正確に決めにくい
- 他のウィジェットとの位置関係が把握しづらい

### 定量的データ（あれば）
- 現在の表示: テキストのみ（「移動中...」）
- ユーザビリティ: ドロップ位置の調整に複数回のトライが必要になる可能性

## ✨ 改善後の期待値

- ドラッグ中にウィジェットのアウトライン（枠線）が表示される
- ウィジェットのサイズと形状が視覚的に確認できる
- ドロップ先を一度で正確に決定できる
- 他のウィジェットとの位置関係が把握しやすくなる
- より直感的で快適な配置操作が可能になる

### 定量的目標（あれば）
- ウィジェット配置時の操作回数を削減
- ドラッグ操作の満足度向上

## 🔧 改善方法

### アプローチ1: カスタムドラッグプレビューの実装
React DnD の `DragPreviewImage` または `useDragLayer` を使用して、ドラッグ中にウィジェットのアウトラインを表示する。

**メリット**:
- ウィジェットの実際のサイズと形状を表示できる
- 透明度を調整して背景のキャンバスが見やすくなる
- カスタマイズ性が高い

**デメリット**:
- 実装がやや複雑
- パフォーマンスへの影響を考慮する必要がある

### 選択したアプローチ
アプローチ1（カスタムドラッグプレビュー）を選択。ユーザーにとって最も視覚的にわかりやすく、React DnDの標準的な機能を活用できるため。

## ✅ 実装タスク

- [ ] ウィジェットのドラッグプレビューコンポーネントを作成
- [ ] アウトライン表示のスタイリング実装（枠線、透明度など）
- [ ] ドラッグ中のウィジェットサイズ・位置情報の取得
- [ ] 既存のドラッグ処理との統合
- [ ] 各ウィジェットタイプ（Button, Input, Textなど）で動作確認

## 📦 変更対象ファイル

- [ ] `src/components/builder/Canvas.tsx` - ドラッグプレビューの統合
- [ ] `src/components/builder/WidgetDragPreview.tsx` - 新規作成：アウトライン表示コンポーネント
- [ ] `src/components/builder/Toolbar.tsx` - ドラッグ開始時のプレビュー設定
- [ ] `src/styles/` - アウトラインのスタイル定義

## 🧪 テスト計画

### 既存機能の回帰テスト
- [ ] ウィジェットのドラッグ&ドロップが正常に動作する
- [ ] ドロップ後の位置が正しく保存される
- [ ] 複数ウィジェットの配置が正常に動作する
- [ ] ツールバーからのウィジェット追加が正常に動作する

### UXテスト
- [ ] ドラッグ中にアウトラインが正しく表示される
- [ ] アウトラインのサイズがウィジェットの実際のサイズと一致する
- [ ] 透明度が適切で背景が見やすい
- [ ] ドラッグ操作がスムーズで遅延がない
- [ ] 各ウィジェットタイプで適切にアウトラインが表示される

### ビフォー・アフター比較
| 指標 | Before | After | 改善 |
|------|--------|-------|------|
| ドラッグ中の視覚情報 | テキストのみ | ウィジェットアウトライン | ✓ |
| 配置位置の把握しやすさ | 低 | 高 | ✓ |
| 操作の直感性 | 低 | 高 | ✓ |

## ⚠️ リスクと影響範囲

- リスク1: ドラッグ操作時のパフォーマンス低下
  - 対策: 軽量なアウトライン表示の実装、必要に応じて最適化
- リスク2: 既存のドラッグ&ドロップ機能への影響
  - 対策: 十分な回帰テストを実施、段階的な実装
- リスク3: ブラウザ間の表示差異
  - 対策: 主要ブラウザでの動作確認を実施

## 📊 完了条件

- [ ] 全実装タスク完了
- [ ] 既存のドラッグ&ドロップ機能に影響がないことを確認
- [ ] 全ウィジェットタイプでアウトラインが正しく表示される
- [ ] コードレビュー完了
- [ ] テスト完了
- [ ] 主要ブラウザ（Chrome, Firefox, Safari, Edge）で動作確認

## 📝 メモ

チケット作成日: 2025-10-22

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: React DnD Custom Drag Layer - https://react-dnd.github.io/react-dnd/examples/drag-around/custom-drag-layer
