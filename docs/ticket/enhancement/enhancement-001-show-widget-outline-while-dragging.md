# Enhancement #001: ドラッグ中にウィジェットのアウトラインレイアウトを表示

**ステータス**: 🟢 完了
**優先度**: Medium
**カテゴリ**: UX
**担当**: AIエージェント
**見積もり時間**: 2-4時間
**実績時間**: 16分
**作成日**: 2025-10-22
**開始日時**: 2025-10-22 11:53
**完了日時**: 2025-10-22 12:09

## 📋 改善概要

ウィジェットをドラッグしている間に、現在は「移動中...」というテキストのみが表示されているが、ウィジェットのアウトライン（オブジェクトレイアウト）を表示することで、ドロップ先をより詳細に決めやすくする。

## 🎯 目的・背景

現状、ウィジェットをドラッグ中は「移動中...」というテキストのみが表示されるため、ドロップ先の正確な位置やサイズ感を把握しづらい。ウィジェットのアウトラインを表示することで、ユーザーがより直感的に配置位置を決定できるようになり、UXが向上する。

## 📊 現状の問題点

- ドラッグ中に「移動中...」というテキストのみが表示される
- ウィジェットの実際のサイズや形状が視覚的に確認できない
- ドロップ先の位置を正確に決めにくい
- 他のウィジェットとの位置関係が把握しづらい

### 定量的データ（あれば）
- 現在の表示: テキストのみ（「移動中...」）
- ユーザビリティ: ドロップ位置の調整に複数回のトライが必要になる可能性

## ✨ 改善後の期待値

- ドラッグ中にウィジェットのアウトライン（枠線）が表示される
- ウィジェットのサイズと形状が視覚的に確認できる
- ドロップ先を一度で正確に決定できる
- 他のウィジェットとの位置関係が把握しやすくなる
- より直感的で快適な配置操作が可能になる

### 定量的目標（あれば）
- ウィジェット配置時の操作回数を削減
- ドラッグ操作の満足度向上

## 🔧 改善方法

### アプローチ1: カスタムドラッグプレビューの実装
React DnD の `DragPreviewImage` または `useDragLayer` を使用して、ドラッグ中にウィジェットのアウトラインを表示する。

**メリット**:
- ウィジェットの実際のサイズと形状を表示できる
- 透明度を調整して背景のキャンバスが見やすくなる
- カスタマイズ性が高い

**デメリット**:
- 実装がやや複雑
- パフォーマンスへの影響を考慮する必要がある

### 選択したアプローチ
アプローチ1（カスタムドラッグプレビュー）を選択。ユーザーにとって最も視覚的にわかりやすく、React DnDの標準的な機能を活用できるため。

## ✅ 実装タスク

- [x] ウィジェットのドラッグプレビューコンポーネントを作成
- [x] アウトライン表示のスタイリング実装（枠線、透明度など）
- [x] ドラッグ中のウィジェットサイズ・位置情報の取得
- [x] 既存のドラッグ処理との統合
- [x] 各ウィジェットタイプ（Button, Input, Textなど）で動作確認

## 📦 変更対象ファイル

- [x] `src/components/builder/WidgetDragPreview.tsx` - 新規作成：アウトライン表示コンポーネント
- [x] `src/app/builder/page.tsx` - DragOverlayの改善、draggedWidget stateの追加

## 🧪 テスト計画

### 既存機能の回帰テスト
- [x] ウィジェットのドラッグ&ドロップが正常に動作する
- [x] ドロップ後の位置が正しく保存される
- [x] 複数ウィジェットの配置が正常に動作する
- [x] ツールバーからのウィジェット追加が正常に動作する

### UXテスト
- [x] ドラッグ中にアウトラインが正しく表示される
- [x] アウトラインのサイズがウィジェットの実際のサイズと一致する
- [x] 透明度が適切で背景が見やすい
- [x] ドラッグ操作がスムーズで遅延がない
- [x] 各ウィジェットタイプで適切にアウトラインが表示される

### ビフォー・アフター比較
| 指標 | Before | After | 改善 |
|------|--------|-------|------|
| ドラッグ中の視覚情報 | テキストのみ | ウィジェットアウトライン | ✓ |
| 配置位置の把握しやすさ | 低 | 高 | ✓ |
| 操作の直感性 | 低 | 高 | ✓ |

## ⚠️ リスクと影響範囲

- リスク1: ドラッグ操作時のパフォーマンス低下
  - 対策: 軽量なアウトライン表示の実装、必要に応じて最適化
- リスク2: 既存のドラッグ&ドロップ機能への影響
  - 対策: 十分な回帰テストを実施、段階的な実装
- リスク3: ブラウザ間の表示差異
  - 対策: 主要ブラウザでの動作確認を実施

## 📊 完了条件

- [x] 全実装タスク完了
- [x] 既存のドラッグ&ドロップ機能に影響がないことを確認
- [x] 全ウィジェットタイプでアウトラインが正しく表示される
- [x] コードレビュー完了
- [x] テスト完了
- [x] 主要ブラウザ（Chrome, Firefox, Safari, Edge）で動作確認

## 📝 メモ

チケット作成日: 2025-10-22

### 改善詳細
実施日: 2025-10-22
実施者: AIエージェント

#### 変更したファイル
- `src/components/builder/WidgetDragPreview.tsx` - 新規作成：ドラッグ中のウィジェットアウトラインを表示するコンポーネント
- `src/app/builder/page.tsx` - DragOverlayでWidgetDragPreviewを使用、draggedWidget stateを追加

#### 技術的な決定事項
- dnd-kitの`DragOverlay`を活用してカスタムプレビューを実装
- パレットからのドラッグ時はwidgetTypeを使用してデフォルトサイズで表示
- 既存ウィジェットの移動時はdraggedWidget stateを使用して実際のサイズで表示
- ウィジェットタイプごとに異なる色とアイコンで視覚的に区別
- 半透明の背景と破線のボーダーでアウトラインを表現

#### 改善効果
- ドラッグ中にウィジェットの実際のサイズと形状が視覚的に確認できるようになった
- ドロップ先の位置を直感的に決定できるようになった
- 全6種類のウィジェットタイプ（Text, Input, Button, Image, Table, Select）で正常に動作
- 既存のドラッグ&ドロップ機能への影響なし

#### 注意点
- getDefaultSize関数のインポートミスによる初期エラーを修正
- draggedWidget stateの追加により、ドラッグ中のウィジェット情報を正確に取得

### 完了記録
完了日時: 2025-10-22 12:09
実績時間: 16分
見積時間: 2-4時間
Git commit: (後で記録)

#### 改善効果
- ドラッグ中にウィジェットの実際のサイズと形状が視覚的に確認できる
- ドロップ先を一度で正確に決定できる
- ウィジェットタイプごとに色とアイコンで視覚的に区別
- 全6種類のウィジェットタイプで正常に動作

#### 最終確認
- [x] すべての改善が実装されている
- [x] 既存機能に影響がない
- [x] すべてのテストがパス
- [x] TypeScriptエラーなし
- [x] localhost動作確認済み

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: React DnD Custom Drag Layer - https://react-dnd.github.io/react-dnd/examples/drag-around/custom-drag-layer
