# Bug #006: エクスポートしたHTMLでセレクトとテーブルが表示されない

**ステータス**: 🟢 完了
**優先度**: High
**担当**: AIエージェント
**開始日時**: 2025-10-23 00:00
**完了日時**: 2025-10-23 00:30
**実績時間**: 30分
**作成日**: 2025-10-22

## 🐛 バグ概要

エクスポート機能で生成されたHTMLファイルを開くと、セレクト（Select）とテーブル（Table）のウィジェットが表示されない。

## 📍 発生環境

- ブラウザ: 未確認
- OS: 未確認
- URL: エクスポートされたHTMLファイル
- バージョン: -

## 🔄 再現手順

1. NoCode UI Builderでセレクトウィジェットとテーブルウィジェットを配置
2. エクスポート機能を使用してHTMLファイルを生成
3. 生成されたHTMLファイルをブラウザで開く
4. セレクトとテーブルのウィジェットが表示されないことを確認

## ❌ 期待される動作

エクスポートされたHTMLファイルを開いたとき、ビルダー上で配置したすべてのウィジェット（セレクトとテーブルを含む）が正しく表示されること。

## 🚨 実際の動作

エクスポートされたHTMLファイルを開くと、セレクトとテーブルのウィジェットが表示されない（他のウィジェットは正常に表示される可能性あり）。

## 📸 スクリーンショット/ログ

未添付

## 🔍 原因分析

**根本原因**: ビルダーページ内に定義されていた簡易的な`generateHTML`関数のswitchステートメント（443-470行）に、`Table`と`Select`のケースが実装されていなかったため、これらのウィジェットはdefaultケースにフォールバックし、空の`<div>`として出力されていた。

**詳細**:
- [src/app/builder/page.tsx:443-503](src/app/builder/page.tsx#L443-L503)にローカルの`generateHTML`関数が存在
- この関数は`Text`、`Button`、`Input`、`Image`のみをサポート
- `Table`と`Select`は`default`ケースで空の`<div>`として処理されていた
- 一方、`src/lib/export/html-generator.ts`には完全な実装が存在したが、ビルダーページでは使用されていなかった

## ✅ 修正内容

- [x] 修正コミット: 7d7ae44d5abf4a51e4313a32ade26d07293ec17e
- [x] 影響範囲: ビルダーページのエクスポート機能のみ
- [x] テスト実施: localhost動作確認完了

### 修正詳細

**ファイル**: [src/app/builder/page.tsx](src/app/builder/page.tsx)

**変更内容**:
1. 正式なHTML生成関数をインポート
   - `import { generateHTML as generateHTMLExport } from '@/lib/export/html-generator'`
   - `import type { CanvasData } from '@/types/export'`

2. `handleExport`関数を修正（313-342行）
   - WidgetリストをCanvasData形式に変換
   - `generateHTMLExport`関数を使用してHTML生成
   - 全ウィジェットタイプ（Table、Selectを含む）が正しくエクスポートされるように修正

3. ビルダーページ内の旧`generateHTML`関数を削除（443-503行）
   - コードの重複を排除
   - メンテナンス性を向上

**理由**:
- `src/lib/export/html-generator.ts`には既に全ウィジェットタイプの完全な実装が存在
- コードの重複を避け、単一の信頼できるHTML生成ロジックを使用
- 将来的に新しいウィジェットを追加する際も、1箇所の修正で済む

## 🧪 テスト確認項目

- [x] セレクトウィジェットがエクスポートされたHTMLで正しく表示されることを確認
- [x] テーブルウィジェットがエクスポートされたHTMLで正しく表示されることを確認
- [x] その他のウィジェット（ボタン、インプット等）も引き続き正常に表示されることを確認
- [x] エクスポートされたHTMLが単体で動作することを確認（外部依存なし）
- [x] 複数ブラウザで動作確認

## 📝 メモ

修正実施日: 2025-10-23
修正者: AIエージェント

**修正時の気付き**:
- `/api/export/[id]` エンドポイントは既に正しい実装（`src/lib/export/html-generator.ts`）を使用していたため、API経由のエクスポートには問題なし
- 問題はビルダーページのクライアントサイドエクスポート機能のみ
- コードの重複が問題の原因だったため、単一の信頼できるHTML生成ロジックに統一することで解決
- この修正により、将来的に新しいウィジェットを追加する際も、メンテナンスが容易になる

チケット作成日: 2025-10-22

エクスポート機能はユーザーが作成したUIを実際に使用するための重要な機能であり、一部のウィジェットが表示されないことは主要機能の不具合として優先度Highで対応が必要。

### 完了記録
完了日時: 2025-10-23 00:30
実績時間: 30分
Git commit: 7d7ae44d5abf4a51e4313a32ade26d07293ec17e

#### 最終確認
- [x] バグが完全に修正されている
- [x] 関連機能に影響がない
- [x] テストがすべてパス
- [x] TypeScriptエラーなし

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: -
