# Bug #005: キャンバスとプレビューのサイズ不一致によるウィジェット表示問題

**ステータス**: 🟢 完了
**優先度**: Medium
**担当**: AIエージェント
**作成日**: 2025-10-22
**開始日時**: 2025-10-22 16:30
**完了日時**: 2025-10-22 17:00
**実績時間**: 30分

## 🐛 バグ概要

キャンバスのサイズとプレビューのサイズが一致していないため、プレビューの想定範囲外にウィジェットが表示される問題が発生しています。これにより、編集時とプレビュー時でウィジェットの配置が異なって見える状態になっています。

## 📍 発生環境

- ブラウザ: 未確認
- OS: 未確認
- URL: -
- バージョン: -

## 🔄 再現手順

1. キャンバスでウィジェットを配置する
2. プレビューモードに切り替える
3. キャンバスとプレビューでウィジェットの表示位置・範囲が異なることを確認

## ❌ 期待される動作

キャンバスで配置したウィジェットの位置とサイズが、プレビューモードでも正確に再現されるべき。キャンバスとプレビューのサイズが一致し、ウィジェットが想定範囲内に正しく表示されるべき。

## 🚨 実際の動作

キャンバスとプレビューのサイズが不一致のため、プレビュー時にウィジェットが想定範囲外に表示されたり、位置がずれて表示される。

## 📸 スクリーンショット/ログ

未添付

## 🔍 原因分析

キャンバスとプレビューでサイズ定義が不一致でした：

1. **Canvas.tsx (ビルダー側)**:
   - `w-full h-full min-h-[600px]` で親要素に依存した可変サイズ
   - 実際のサイズが環境によって変動

2. **Preview page (プレビュー側)**:
   - `min-h-[600px]` のみで固定サイズなし
   - 最小高さのみの指定で幅が不定

3. **builder/page.tsx (キャンバスコンテナ)**:
   - `p-6` (24px) のパディングが含まれ、実際の描画領域が変化

4. **エクスポートHTML**:
   - `min-height: 600px` のみで固定サイズなし

これらの不一致により、ウィジェットの絶対座標がキャンバス、プレビュー、エクスポートHTMLでそれぞれ異なる位置に表示されていました。

## ✅ 修正内容

キャンバス、プレビュー、エクスポートHTMLのサイズを固定サイズ（1200px × 800px）に統一しました。

- [x] 修正コミット: 999c1d687c145be09584c226871e398f2c40e1cd
- [x] 影響範囲: Canvas.tsx、Preview page、エクスポートHTML生成関数
- [x] テスト実施: ブラウザでの視覚的確認、TypeScriptコンパイルチェック

### 修正詳細

1. **src/components/builder/Canvas.tsx (Line 58-60)**:
   - 変更前: `className="relative w-full h-full min-h-[600px] bg-white overflow-auto"`
   - 変更後: `className="relative bg-white"` + `style={{ width: '1200px', height: '800px' }}`
   - 理由: 固定サイズに統一してプレビューと一致させる

2. **src/app/preview/[id]/page.tsx (Line 134-135)**:
   - 変更前: `className="relative min-h-[600px] bg-white border border-gray-200 rounded-lg"`
   - 変更後: `className="p-6 flex justify-center"` + `style={{ width: '1200px', height: '800px' }}`
   - 理由: キャンバスと同じ固定サイズに統一

3. **src/app/builder/page.tsx (Line 488-494)**:
   - エクスポートHTML生成関数のCSSを修正
   - `.container` に `width: 1200px; height: 800px;` を追加
   - 理由: エクスポートされるHTMLもキャンバス/プレビューと同じサイズに統一

## 🧪 テスト確認項目

- [x] キャンバスとプレビューのサイズが一致していることを確認
- [x] ウィジェットの配置位置がキャンバスとプレビューで同じことを確認
- [x] 様々なサイズのウィジェットで正しく表示されることを確認
- [x] TypeScriptコンパイルエラーがないことを確認
- [x] localhost動作確認完了

## 📝 メモ

チケット作成日: 2025-10-22
修正実施日: 2025-10-22 16:45
修正者: AIエージェント

**修正時の気付き**:
- 固定サイズ（1200px × 800px）を採用することで、キャンバス、プレビュー、エクスポートHTML全てで一貫した表示が可能になりました
- キャンバスが画面より大きい場合はスクロールで対応する設計です
- 将来的にはキャンバスサイズを可変にする場合、プレビューとエクスポートも同期して変更する必要があります

### 完了記録
完了日時: 2025-10-22 17:00
実績時間: 30分
Git commit: 999c1d687c145be09584c226871e398f2c40e1cd

#### 最終確認
- [x] バグが完全に修正されている
- [x] 関連機能に影響がない
- [x] テストがすべてパス
- [x] TypeScriptエラーなし

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: -
