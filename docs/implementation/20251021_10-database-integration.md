# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥**: 2025å¹´10æœˆ21æ—¥
**Phase**: 10 - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆã¨APIå®Ÿè£…
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

---

## ç›®æ¬¡

1. [Neon PostgreSQLå®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#1-neon-postgresqlå®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
2. [ç’°å¢ƒå¤‰æ•°è¨­å®š](#2-ç’°å¢ƒå¤‰æ•°è¨­å®š)
3. [Drizzleãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ](#3-drizzleãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ)
4. [Drizzle Studioä½¿ç”¨æ–¹æ³•](#4-drizzle-studioä½¿ç”¨æ–¹æ³•)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ](#5-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ)
6. [APIå‹•ä½œç¢ºèª](#6-apiå‹•ä½œç¢ºèª)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#7-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## 1. Neon PostgreSQLå®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Neonã¯ã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹PostgreSQLã‚µãƒ¼ãƒ“ã‚¹ã§ã€ç„¡æ–™æ ã§ç°¡å˜ã«é–‹å§‹ã§ãã¾ã™ã€‚

### 1.1 Neonã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

#### ã‚¹ãƒ†ãƒƒãƒ—1: Neonå…¬å¼ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ [https://neon.tech](https://neon.tech) ã‚’é–‹ã
2. å³ä¸Šã® **Sign Up** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

#### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ–¹æ³•ã®é¸æŠ

ä»¥ä¸‹ã®3ã¤ã®æ–¹æ³•ã‹ã‚‰ã„ãšã‚Œã‹ã‚’é¸æŠ:
- **GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** (æ¨å¥¨)
- **Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**
- **Email + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**

```
æ¨å¥¨: GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
ç†ç”±: å¾Œã§Vercelã¨çµ±åˆã™ã‚‹éš›ã«ä¾¿åˆ©
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: èªè¨¼ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª

1. é¸æŠã—ãŸãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§èªè¨¼ã‚’å®Œäº†
2. Emailã®å ´åˆã¯ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

### 1.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

#### ã‚¹ãƒ†ãƒƒãƒ—1: æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. Neonãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ **Create a project** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã‚’å…¥åŠ›:

```yaml
Project name: nocode-ui-builder
Region: US East (Ohio) - us-east-2  # æœ€ã‚‚è¿‘ã„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠ
PostgreSQL version: 16 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®é¸æŠåŸºæº–

| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | å ´æ‰€ | æ¨å¥¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ |
|----------|------|------------|
| US East (Ohio) | ç±³å›½æ±éƒ¨ | æ—¥æœ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼ˆä½é…å»¶ï¼‰ |
| US West (Oregon) | ç±³å›½è¥¿éƒ¨ | ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹å‘ã‘ |
| Europe (Frankfurt) | ãƒ‰ã‚¤ãƒ„ | ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ |
| Asia Pacific (Singapore) | ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ« | æ±å—ã‚¢ã‚¸ã‚¢ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ |

```
æ—¥æœ¬ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆ:
- US East (Ohio) ã¾ãŸã¯ Asia Pacific (Singapore) ã‚’æ¨å¥¨
- Vercelã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¨åˆã‚ã›ã‚‹ã¨ã•ã‚‰ã«é«˜é€Ÿ
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Œäº†

1. **Create Project** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æ•°ç§’ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚Œã‚‹
3. è‡ªå‹•çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ `neondb` ãŒä½œæˆã•ã‚Œã‚‹

### 1.3 æ¥ç¶šæ–‡å­—åˆ—ã®å–å¾—

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ¥ç¶šæƒ…å ±ã‚’ç¢ºèª

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã® **Connection Details** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹ã
2. **Connection string** ã‚¿ãƒ–ã‚’é¸æŠ

#### ã‚¹ãƒ†ãƒƒãƒ—2: æ¥ç¶šæ–‡å­—åˆ—ã®ã‚³ãƒ”ãƒ¼

```
è¡¨ç¤ºã•ã‚Œã‚‹æ¥ç¶šæ–‡å­—åˆ—ã®å½¢å¼:
postgresql://[username]:[password]@[endpoint].us-east-2.aws.neon.tech/neondb?sslmode=require
```

**å®Ÿéš›ã®ä¾‹**:
```
postgresql://nocode_ui_builder_owner:AbCdEfGh1234567890@ep-cool-meadow-12345678.us-east-2.aws.neon.tech/nocode_ui_builder?sslmode=require
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: æ¥ç¶šæ–‡å­—åˆ—ã®æ§‹æˆè¦ç´ 

| è¦ç´  | èª¬æ˜ | ä¾‹ |
|-----|------|-----|
| username | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼å | nocode_ui_builder_owner |
| password | è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | AbCdEfGh1234567890 |
| endpoint | Neonã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ep-cool-meadow-12345678.us-east-2.aws.neon.tech |
| database | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å | nocode_ui_builder |
| sslmode | SSLæ¥ç¶šãƒ¢ãƒ¼ãƒ‰ | require (å¿…é ˆ) |

#### ã‚¹ãƒ†ãƒƒãƒ—4: æ¥ç¶šæ–‡å­—åˆ—ã‚’å®‰å…¨ã«ä¿å­˜

```bash
# ä¸€æ™‚çš„ã«ãƒ¡ãƒ¢å¸³ãªã©ã«ä¿å­˜
# å¾Œã§ .env.local ã«è¨­å®šã™ã‚‹
```

**é‡è¦ãªæ³¨æ„äº‹é …**:
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯1åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„
- ç´›å¤±ã—ãŸå ´åˆã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆå¯èƒ½
- çµ¶å¯¾ã«GitHubãªã©ã«å…¬é–‹ã—ãªã„

### 1.4 Neonç„¡æ–™æ ã®åˆ¶é™

#### ç„¡æ–™ãƒ—ãƒ©ãƒ³ (Free Tier) ã®ä»•æ§˜

| é …ç›® | åˆ¶é™ |
|-----|------|
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | æœ€å¤§ 0.5 GB |
| ãƒ‡ãƒ¼ã‚¿è»¢é€ | æœˆ 5 GB |
| Computeæ™‚é–“ | æœˆ 191.9æ™‚é–“ (ç´„8æ—¥åˆ†) |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•° | 1å€‹ |
| ãƒ–ãƒ©ãƒ³ãƒæ•° | 10å€‹ |
| åŒæ™‚æ¥ç¶šæ•° | åˆ¶é™ã‚ã‚Š |
| è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ« | ã‚ã‚Š |
| ãƒã‚¤ãƒ³ãƒˆã‚¤ãƒ³ã‚¿ã‚¤ãƒ ãƒªã‚«ãƒãƒª | 7æ—¥é–“ |

```
ç„¡æ–™æ ã§ååˆ†ãªç†ç”±:
- ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚¢ãƒ—ãƒªã«ã¯ååˆ†ãªãƒªã‚½ãƒ¼ã‚¹
- å¿…è¦ã«å¿œã˜ã¦æœ‰æ–™ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¯èƒ½
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ã§çªç™ºçš„ãªã‚¢ã‚¯ã‚»ã‚¹ã«ã‚‚å¯¾å¿œ
```

---

## 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

### 2.1 `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
cd c:\Users\mitoi\Desktop\Projects\nocode-ui-builder

# .env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch .env.local
```

**Windows (PowerShell) ã®å ´åˆ**:
```powershell
New-Item .env.local -ItemType File
```

**Windows (ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ) ã®å ´åˆ**:
```cmd
type nul > .env.local
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: æ¥ç¶šæ–‡å­—åˆ—ã‚’è¨­å®š

`.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¨˜è¿°:

```env
# Neon PostgreSQLæ¥ç¶šæ–‡å­—åˆ—
DATABASE_URL="postgresql://nocode_ui_builder_owner:AbCdEfGh1234567890@ep-cool-meadow-12345678.us-east-2.aws.neon.tech/nocode_ui_builder?sslmode=require"
```

**é‡è¦**:
- ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ `"` ã§å›²ã‚€
- æ”¹è¡Œã‚„ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥ã‚Œãªã„
- å®Ÿéš›ã®æ¥ç¶šæ–‡å­—åˆ—ã«ç½®ãæ›ãˆã‚‹

#### ã‚¹ãƒ†ãƒƒãƒ—3: `.gitignore` ç¢ºèª

`.env.local` ãŒGitç®¡ç†å¤–ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª:

```bash
# .gitignore ã®å†…å®¹ã‚’ç¢ºèª
cat .gitignore
```

`.gitignore` ã«ä»¥ä¸‹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª:

```gitignore
# env files
.env
.env.local
.env.development.local
.env.test.local
.env.production.local
```

### 2.2 ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼

#### ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

ç°¡æ˜“ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ:

```typescript
// scripts/test-env.ts
if (!process.env.DATABASE_URL) {
  console.error('âŒ DATABASE_URL ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
  process.exit(1);
}

console.log('âœ… DATABASE_URL ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
console.log('æ¥ç¶šå…ˆ:', process.env.DATABASE_URL.split('@')[1]); // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’éš ã™
```

å®Ÿè¡Œ:

```bash
npx tsx scripts/test-env.ts
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
```
âœ… DATABASE_URL ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ
æ¥ç¶šå…ˆ: ep-cool-meadow-12345678.us-east-2.aws.neon.tech/nocode_ui_builder?sslmode=require
```

---

## 3. Drizzleãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### 3.1 Drizzle Kitè¨­å®šç¢ºèª

#### `drizzle.config.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

```typescript
import type { Config } from 'drizzle-kit';

export default {
  schema: './src/lib/db/schema.ts',
  out: './drizzle',
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
} satisfies Config;
```

**è¨­å®šé …ç›®ã®èª¬æ˜**:

| é …ç›® | èª¬æ˜ | å€¤ |
|-----|------|-----|
| schema | ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ« | ./src/lib/db/schema.ts |
| out | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›å…ˆ | ./drizzle |
| dialect | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¨®é¡ | postgresql |
| dbCredentials.url | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šURL | ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾— |

### 3.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ

#### ã‚¹ãƒ†ãƒƒãƒ—1: `drizzle-kit generate` ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```bash
# ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
npx drizzle-kit generate
```

**å®Ÿè¡Œä¾‹**:
```
$ npx drizzle-kit generate

ğŸ‰ Generating migrations...

ğŸ“¦ Reading schema from ./src/lib/db/schema.ts
âœ… Schema loaded successfully

ğŸ“ Generating migration file...
âœ… Migration file created: ./drizzle/0000_initial_schema.sql

âœ¨ Done! Migration files generated in ./drizzle
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª

```bash
# drizzleãƒ•ã‚©ãƒ«ãƒ€ã®å†…å®¹ã‚’ç¢ºèª
ls -la drizzle/
```

ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:
```
drizzle/
â”œâ”€â”€ 0000_initial_schema.sql       # SQL ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ meta/
    â”œâ”€â”€ _journal.json              # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´
    â””â”€â”€ 0000_snapshot.json         # ã‚¹ã‚­ãƒ¼ãƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: SQLãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ç¢ºèª

```bash
cat drizzle/0000_initial_schema.sql
```

æœŸå¾…ã•ã‚Œã‚‹å†…å®¹:
```sql
CREATE TABLE IF NOT EXISTS "projects" (
  "id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
  "name" varchar(255) NOT NULL,
  "description" text,
  "canvas_data" jsonb DEFAULT '{"components":[]}'::jsonb NOT NULL,
  "created_at" timestamp with time zone DEFAULT now() NOT NULL,
  "updated_at" timestamp with time zone DEFAULT now() NOT NULL
);

CREATE INDEX IF NOT EXISTS "idx_projects_created_at" ON "projects" ("created_at" DESC);
CREATE INDEX IF NOT EXISTS "idx_projects_updated_at" ON "projects" ("updated_at" DESC);
```

### 3.3 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: `drizzle-kit push` ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é©ç”¨
npx drizzle-kit push
```

**å®Ÿè¡Œä¾‹**:
```
$ npx drizzle-kit push

ğŸš€ Pushing schema to database...

ğŸ“¡ Connecting to database...
âœ… Connected to Neon PostgreSQL

ğŸ“‹ Applying migrations...
  â†’ Creating table "projects"
  â†’ Creating index "idx_projects_created_at"
  â†’ Creating index "idx_projects_updated_at"

âœ… Schema pushed successfully!
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: å®Ÿè¡Œçµæœã®ç¢ºèª

æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OK:
```
âœ… Schema pushed successfully!
```

### 3.4 ã‚¨ãƒ©ãƒ¼å¯¾å‡¦æ³•

#### ã‚¨ãƒ©ãƒ¼1: `DATABASE_URL is not defined`

**åŸå› **: ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# .env.local ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
ls -la .env.local

# ç’°å¢ƒå¤‰æ•°ã‚’æ‰‹å‹•ã§è¨­å®š
export DATABASE_URL="postgresql://..."

# å†å®Ÿè¡Œ
npx drizzle-kit push
```

#### ã‚¨ãƒ©ãƒ¼2: `Connection timeout`

**åŸå› **: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œã¾ãŸã¯Neonã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€æ™‚çš„ãªå•é¡Œ

**è§£æ±ºæ–¹æ³•**:
```bash
# 1. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèª
ping neon.tech

# 2. Neonãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ã‚’ç¢ºèª
# https://neon.tech/status

# 3. æ•°åˆ†å¾…ã£ã¦å†å®Ÿè¡Œ
npx drizzle-kit push
```

#### ã‚¨ãƒ©ãƒ¼3: `SSL certificate verification failed`

**åŸå› **: SSLè¨¼æ˜æ›¸ã®æ¤œè¨¼å•é¡Œ

**è§£æ±ºæ–¹æ³•**:

æ¥ç¶šæ–‡å­—åˆ—ã« `sslmode=require` ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª:
```env
DATABASE_URL="postgresql://...?sslmode=require"
```

ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–:
```env
DATABASE_URL="postgresql://...?sslmode=no-verify"
```

#### ã‚¨ãƒ©ãƒ¼4: `permission denied for schema public`

**åŸå› **: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¨©é™ã®å•é¡Œ

**è§£æ±ºæ–¹æ³•**:

Neonãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§:
1. **SQL Editor** ã‚’é–‹ã
2. ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œ:

```sql
GRANT ALL PRIVILEGES ON SCHEMA public TO <username>;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO <username>;
```

---

## 4. Drizzle Studioä½¿ç”¨æ–¹æ³•

Drizzle Studioã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’GUIã§ç®¡ç†ã§ãã‚‹å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### 4.1 Drizzle Studioèµ·å‹•

#### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```bash
npx drizzle-kit studio
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã

å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:

```
ğŸ¨ Drizzle Studio is running on https://local.drizzle.studio

ğŸ“Š Connected to: neon postgresql database
ğŸ“‚ Schema: ./src/lib/db/schema.ts

ğŸš€ Press Ctrl+C to stop
```

è‡ªå‹•çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ `https://local.drizzle.studio` ãŒé–‹ãã¾ã™ã€‚

### 4.2 Drizzle Studioã®æ©Ÿèƒ½

#### æ©Ÿèƒ½1: ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§è¡¨ç¤º

å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã« `projects` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

#### æ©Ÿèƒ½2: ãƒ‡ãƒ¼ã‚¿ã®é–²è¦§

1. `projects` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤ºã•ã‚Œã‚‹
3. ã‚«ãƒ©ãƒ ã”ã¨ã«ã‚½ãƒ¼ãƒˆå¯èƒ½

#### æ©Ÿèƒ½3: ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 

1. å³ä¸Šã® **Add Row** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›:

```yaml
name: "ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"
description: "Drizzle Studioã‹ã‚‰ã®ãƒ†ã‚¹ãƒˆä½œæˆ"
canvas_data:
  {
    "components": [
      {
        "id": "test-1",
        "type": "Text",
        "position": { "x": 100, "y": 100 },
        "size": { "width": 200, "height": 50 },
        "props": { "content": "Hello from Drizzle Studio!" }
      }
    ]
  }
```

3. **Save** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

#### æ©Ÿèƒ½4: ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†

1. ç·¨é›†ã—ãŸã„è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç›´æ¥ç·¨é›†
3. è‡ªå‹•ä¿å­˜ã•ã‚Œã‚‹

#### æ©Ÿèƒ½5: ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤

1. å‰Šé™¤ã—ãŸã„è¡Œã‚’é¸æŠ
2. **Delete** ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ **Confirm** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### æ©Ÿèƒ½6: SQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ

1. ä¸Šéƒ¨ã® **SQL** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. SQLã‚¯ã‚¨ãƒªã‚’å…¥åŠ›:

```sql
SELECT * FROM projects WHERE name LIKE '%ãƒ†ã‚¹ãƒˆ%';
```

3. **Run** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### 4.3 Drizzle Studioã®ä¾¿åˆ©ãªä½¿ã„æ–¹

#### JSONBãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†

`canvas_data` ã‚«ãƒ©ãƒ ã¯JSONBå‹ãªã®ã§ã€JSON EditorãŒè¡¨ç¤ºã•ã‚Œã¾ã™:

1. `canvas_data` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯
2. JSONã‚¨ãƒ‡ã‚£ã‚¿ãŒé–‹ã
3. æ§‹æ–‡ãƒã‚¤ãƒ©ã‚¤ãƒˆã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ä»˜ã
4. ç·¨é›†å¾Œã€**Apply** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

1. ã‚«ãƒ©ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¨ªã®ãƒ•ã‚£ãƒ«ã‚¿ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æ¡ä»¶ã‚’è¨­å®š:

```
name contains "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"
created_at > 2025-10-20
```

3. **Apply** ã‚’ã‚¯ãƒªãƒƒã‚¯

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ

### 5.1 ç°¡æ˜“æ¥ç¶šãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

`scripts/test-db-connection.ts` ã‚’ä½œæˆ:

```typescript
import { neon } from '@neondatabase/serverless';

async function testConnection() {
  try {
    console.log('ğŸ”Œ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹...\n');

    const sql = neon(process.env.DATABASE_URL!);

    // 1. åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ
    console.log('1ï¸âƒ£ åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ');
    const result = await sql`SELECT NOW() as current_time, version() as pg_version`;
    console.log('âœ… æ¥ç¶šæˆåŠŸ!');
    console.log('   ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»:', result[0].current_time);
    console.log('   PostgreSQLãƒãƒ¼ã‚¸ãƒ§ãƒ³:', result[0].pg_version.split(',')[0]);
    console.log('');

    // 2. ãƒ†ãƒ¼ãƒ–ãƒ«å­˜åœ¨ç¢ºèª
    console.log('2ï¸âƒ£ ãƒ†ãƒ¼ãƒ–ãƒ«å­˜åœ¨ç¢ºèª');
    const tables = await sql`
      SELECT table_name
      FROM information_schema.tables
      WHERE table_schema = 'public'
    `;
    console.log('âœ… ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§:');
    tables.forEach(t => console.log(`   - ${t.table_name}`));
    console.log('');

    // 3. projectsãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª
    console.log('3ï¸âƒ£ projectsãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª');
    const columns = await sql`
      SELECT column_name, data_type, is_nullable
      FROM information_schema.columns
      WHERE table_name = 'projects'
      ORDER BY ordinal_position
    `;
    console.log('âœ… ã‚«ãƒ©ãƒ ä¸€è¦§:');
    columns.forEach(c => {
      console.log(`   - ${c.column_name}: ${c.data_type} ${c.is_nullable === 'NO' ? '(NOT NULL)' : ''}`);
    });
    console.log('');

    // 4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
    console.log('4ï¸âƒ£ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª');
    const indexes = await sql`
      SELECT indexname, indexdef
      FROM pg_indexes
      WHERE tablename = 'projects'
    `;
    console.log('âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸€è¦§:');
    indexes.forEach(i => console.log(`   - ${i.indexname}`));
    console.log('');

    console.log('ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸ!');

  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:', error);
    process.exit(1);
  }
}

testConnection();
```

#### å®Ÿè¡Œ:

```bash
npx tsx scripts/test-db-connection.ts
```

#### æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:

```
ğŸ”Œ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹...

1ï¸âƒ£ åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ
âœ… æ¥ç¶šæˆåŠŸ!
   ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»: 2025-10-21T06:30:45.123Z
   PostgreSQLãƒãƒ¼ã‚¸ãƒ§ãƒ³: PostgreSQL 16.0 on x86_64-pc-linux-gnu

2ï¸âƒ£ ãƒ†ãƒ¼ãƒ–ãƒ«å­˜åœ¨ç¢ºèª
âœ… ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§:
   - projects

3ï¸âƒ£ projectsãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª
âœ… ã‚«ãƒ©ãƒ ä¸€è¦§:
   - id: uuid (NOT NULL)
   - name: character varying (NOT NULL)
   - description: text
   - canvas_data: jsonb (NOT NULL)
   - created_at: timestamp with time zone (NOT NULL)
   - updated_at: timestamp with time zone (NOT NULL)

4ï¸âƒ£ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸€è¦§:
   - projects_pkey
   - idx_projects_created_at
   - idx_projects_updated_at

ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸ!
```

### 5.2 Drizzle ORMã§ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

`scripts/test-drizzle.ts` ã‚’ä½œæˆ:

```typescript
import { db } from '@/lib/db';
import { projects } from '@/lib/db/schema';

async function testDrizzle() {
  try {
    console.log('ğŸ”§ Drizzle ORMæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹...\n');

    // 1. å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    console.log('1ï¸âƒ£ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—');
    const allProjects = await db.select().from(projects);
    console.log(`âœ… ${allProjects.length}ä»¶ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
    console.log('');

    // 2. ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
    console.log('2ï¸âƒ£ ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ');
    const newProject = await db.insert(projects).values({
      name: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
      description: 'Drizzle ORMã®æ¥ç¶šãƒ†ã‚¹ãƒˆç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
      canvasData: {
        components: [
          {
            id: 'test-widget-1',
            type: 'Text',
            position: { x: 100, y: 100 },
            size: { width: 300, height: 50 },
            props: {
              content: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ!',
              fontSize: 24,
              color: '#10B981',
            },
          },
        ],
      },
    }).returning();
    console.log('âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæˆåŠŸ!');
    console.log(`   ID: ${newProject[0].id}`);
    console.log(`   åå‰: ${newProject[0].name}`);
    console.log('');

    // 3. ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
    console.log('3ï¸âƒ£ ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—');
    const { eq } = await import('drizzle-orm');
    const fetchedProject = await db
      .select()
      .from(projects)
      .where(eq(projects.id, newProject[0].id));
    console.log('âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—æˆåŠŸ!');
    console.log(`   Canvas Data: ${JSON.stringify(fetchedProject[0].canvasData, null, 2)}`);
    console.log('');

    // 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°
    console.log('4ï¸âƒ£ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°');
    const updatedProject = await db
      .update(projects)
      .set({
        description: 'æ›´æ–°ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
        updatedAt: new Date(),
      })
      .where(eq(projects.id, newProject[0].id))
      .returning();
    console.log('âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°æˆåŠŸ!');
    console.log(`   æ–°ã—ã„èª¬æ˜: ${updatedProject[0].description}`);
    console.log('');

    // 5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤
    console.log('5ï¸âƒ£ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤');
    await db.delete(projects).where(eq(projects.id, newProject[0].id));
    console.log('âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤æˆåŠŸ!');
    console.log('');

    console.log('ğŸ‰ ã™ã¹ã¦ã®Drizzle ORMãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸ!');

  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:', error);
    process.exit(1);
  }
}

testDrizzle();
```

#### å®Ÿè¡Œ:

```bash
npx tsx scripts/test-drizzle.ts
```

---

## 6. APIå‹•ä½œç¢ºèª

### 6.1 API Routeså‹•ä½œç¢ºèª

é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•:

```bash
npm run dev
```

### 6.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ

#### curlã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆ:

```bash
curl -X POST http://localhost:3000/api/projects \
  -H "Content-Type: application/json" \
  -d '{
    "name": "APIãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "description": "APIçµŒç”±ã§ä½œæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "canvasData": {
      "components": [
        {
          "id": "api-test-1",
          "type": "Button",
          "position": { "x": 150, "y": 150 },
          "size": { "width": 200, "height": 50 },
          "props": {
            "text": "Click Me!",
            "variant": "primary"
          }
        }
      ]
    }
  }'
```

#### æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:

```json
{
  "project": {
    "id": "550e8400-e29b-41d4-a716-446655440123",
    "name": "APIãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "description": "APIçµŒç”±ã§ä½œæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "canvasData": {
      "components": [...]
    },
    "createdAt": "2025-10-21T06:45:30.123Z",
    "updatedAt": "2025-10-21T06:45:30.123Z"
  }
}
```

### 6.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—ãƒ†ã‚¹ãƒˆ

```bash
curl http://localhost:3000/api/projects
```

æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:

```json
{
  "projects": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440123",
      "name": "APIãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
      "description": "APIçµŒç”±ã§ä½œæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
      "canvasData": {...},
      "createdAt": "2025-10-21T06:45:30.123Z",
      "updatedAt": "2025-10-21T06:45:30.123Z"
    }
  ]
}
```

### 6.4 ç‰¹å®šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—ãƒ†ã‚¹ãƒˆ

```bash
# ä¸Šè¨˜ã§å–å¾—ã—ãŸIDã‚’ä½¿ç”¨
curl http://localhost:3000/api/projects/550e8400-e29b-41d4-a716-446655440123
```

### 6.5 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°ãƒ†ã‚¹ãƒˆ

```bash
curl -X PUT http://localhost:3000/api/projects/550e8400-e29b-41d4-a716-446655440123 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æ›´æ–°ã•ã‚ŒãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå",
    "description": "APIçµŒç”±ã§æ›´æ–°ã•ã‚Œã¾ã—ãŸ"
  }'
```

### 6.6 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤ãƒ†ã‚¹ãƒˆ

```bash
curl -X DELETE http://localhost:3000/api/projects/550e8400-e29b-41d4-a716-446655440123
```

æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:

```json
{
  "message": "Project deleted successfully"
}
```

### 6.7 Postmanã§ã®ãƒ†ã‚¹ãƒˆ

ã‚ˆã‚Šè¦–è¦šçš„ã«ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆã¯ã€Postmanã‚’ä½¿ç”¨:

#### 1. Postmanã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆ

```json
{
  "info": {
    "name": "NoCode UI Builder API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Get All Projects",
      "request": {
        "method": "GET",
        "url": "http://localhost:3000/api/projects"
      }
    },
    {
      "name": "Create Project",
      "request": {
        "method": "POST",
        "url": "http://localhost:3000/api/projects",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Postmanãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ\",\n  \"description\": \"Postmanã‹ã‚‰ä½œæˆ\"\n}"
        }
      }
    }
  ]
}
```

---

## 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 7.1 SSLè¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:

```
Error: self signed certificate in certificate chain
```

#### åŸå› :

- SSLè¨¼æ˜æ›¸ã®æ¤œè¨¼ã«å¤±æ•—
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã®ãƒ—ãƒ­ã‚­ã‚·è¨­å®š

#### è§£æ±ºæ–¹æ³•:

**æ–¹æ³•1: æ¥ç¶šæ–‡å­—åˆ—ã‚’ä¿®æ­£**

```env
# sslmode=require ã‚’ sslmode=no-verify ã«å¤‰æ›´
DATABASE_URL="postgresql://...?sslmode=no-verify"
```

**æ–¹æ³•2: Node.jsã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š**

```bash
# é–‹ç™ºç’°å¢ƒã®ã¿
export NODE_TLS_REJECT_UNAUTHORIZED=0

# å†å®Ÿè¡Œ
npm run dev
```

### 7.2 ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:

```
Error: Connection timeout
Error: Failed to connect to database
```

#### åŸå› :

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œ
- Neonã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€æ™‚çš„ãªéšœå®³
- ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š

#### è§£æ±ºæ–¹æ³•:

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèª**

```bash
# Neonã¸ã®æ¥ç¶šç¢ºèª
ping ep-xxxxx.us-east-2.aws.neon.tech
```

**ã‚¹ãƒ†ãƒƒãƒ—2: Neonãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèª**

1. Neonãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ **Active** çŠ¶æ…‹ã‹ç¢ºèª
3. **Operations** ã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª

**ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’å»¶é•·**

```typescript
// lib/db/index.ts
import { neon } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-http';

const sql = neon(process.env.DATABASE_URL!, {
  fetchOptions: {
    timeout: 30000, // 30ç§’ã«å»¶é•·
  },
});

export const db = drizzle(sql, { schema });
```

### 7.3 èªè¨¼ã‚¨ãƒ©ãƒ¼

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:

```
Error: password authentication failed for user "username"
Error: Invalid credentials
```

#### åŸå› :

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒé–“é•ã£ã¦ã„ã‚‹
- æ¥ç¶šæ–‡å­—åˆ—ã®å½¢å¼ãŒä¸æ­£

#### è§£æ±ºæ–¹æ³•:

**ã‚¹ãƒ†ãƒƒãƒ—1: æ¥ç¶šæ–‡å­—åˆ—ã®å†ç¢ºèª**

Neonãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰æ¥ç¶šæ–‡å­—åˆ—ã‚’å†å–å¾—:

1. **Connection Details** ã‚’é–‹ã
2. **Reset Password** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æ–°ã—ã„æ¥ç¶šæ–‡å­—åˆ—ã‚’ã‚³ãƒ”ãƒ¼
4. `.env.local` ã‚’æ›´æ–°

**ã‚¹ãƒ†ãƒƒãƒ—2: ç’°å¢ƒå¤‰æ•°ã®å†èª­ã¿è¾¼ã¿**

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•
# Ctrl+C ã§åœæ­¢
npm run dev
```

### 7.4 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:

```
Error: relation "projects" already exists
```

#### åŸå› :

- ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é‡è¤‡å®Ÿè¡Œ

#### è§£æ±ºæ–¹æ³•:

**æ–¹æ³•1: ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã—ã¦å†å®Ÿè¡Œ**

Neon SQL Editorã§:

```sql
DROP TABLE IF EXISTS projects CASCADE;
```

ãã®å¾Œã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†å®Ÿè¡Œ:

```bash
npx drizzle-kit push
```

**æ–¹æ³•2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆ**

```bash
# drizzleãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤
rm -rf drizzle/

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿæˆ
npx drizzle-kit generate
npx drizzle-kit push
```

### 7.5 JSONBå‹ã®ã‚¨ãƒ©ãƒ¼

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:

```
Error: invalid input syntax for type json
```

#### åŸå› :

- JSONãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£
- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®å•é¡Œ

#### è§£æ±ºæ–¹æ³•:

**æ­£ã—ã„JSONã®å½¢å¼ã‚’ç¢ºèª**:

```typescript
// âŒ é–“é•ã„
canvasData: '{"components": []}' // æ–‡å­—åˆ—

// âœ… æ­£ã—ã„
canvasData: { components: [] }   // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
```

### 7.6 ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–

è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª:

```typescript
// lib/db/index.ts
import { drizzle } from 'drizzle-orm/neon-http';

export const db = drizzle(sql, {
  schema,
  logger: true, // SQLã‚¯ã‚¨ãƒªã‚’ãƒ­ã‚°å‡ºåŠ›
});
```

---

## ã¾ã¨ã‚

### å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Neonã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå®Œäº†
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Œäº†
- [ ] æ¥ç¶šæ–‡å­—åˆ—å–å¾—å®Œäº†
- [ ] `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå®Œäº†
- [ ] `npx drizzle-kit generate` æˆåŠŸ
- [ ] `npx drizzle-kit push` æˆåŠŸ
- [ ] Drizzle Studioèµ·å‹•æˆåŠŸ
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] APIå‹•ä½œç¢ºèªå®Œäº†

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

æ¬¡ã¯ **UI/UXãƒ†ã‚¹ãƒˆ** (Phase 11) ã«é€²ã¿ã¾ã™:

```bash
# æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
docs/implementation/20251021_11-ui-ux-testing.md
```

---

**ä½œæˆè€…**: Claude
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ21æ—¥
